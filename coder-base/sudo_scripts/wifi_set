#!/bin/sh
# wifiset SSID PASSWD
echo "setWiFi"
st=`/usr/bin/sudo cat /etc/wpa_supplicant/wpa_supplicant.conf | grep -n "##BEGIN_AUTOGENERATED"`
ed=`/usr/bin/sudo cat /etc/wpa_supplicant/wpa_supplicant.conf | grep -n "##END_AUTOGENERATED"`
st=`echo $st|/bin/sed -e "s/:##BEGIN_AUTOGENERATED//g"` 
ed=`echo $ed|/bin/sed -e "s/:##END_AUTOGENERATED//g"` 
echo ${st},${ed}
/usr/bin/sudo /bin/sed -n ${st},${ed}p /etc/wpa_supplicant/wpa_supplicant.conf
/usr/bin/sudo /bin/sed -i ${st},${ed}d /etc/wpa_supplicant/wpa_supplicant.conf
/usr/bin/sudo echo "##BEGIN_AUTOGENERATED" >> /etc/wpa_supplicant/wpa_supplicant.conf
/usr/bin/sudo echo "network={" >> /etc/wpa_supplicant/wpa_supplicant.conf
/usr/bin/sudo echo "  ssid=\"$1\"">> /etc/wpa_supplicant/wpa_supplicant.conf
/usr/bin/sudo echo "  psk=\"$2\"" >> /etc/wpa_supplicant/wpa_supplicant.conf
/usr/bin/sudo echo "  key_mgmt=WPA-PSK" >>    /etc/wpa_supplicant/wpa_supplicant.conf
/usr/bin/sudo echo "  eap=TTLS PEAP TLS" >> /etc/wpa_supplicant/wpa_supplicant.conf
/usr/bin/sudo echo "  }" >> /etc/wpa_supplicant/wpa_supplicant.conf
/usr/bin/sudo echo "##END_AUTOGENERATED" >> /etc/wpa_supplicant/wpa_supplicant.conf
/usr/bin/sudo /bin/systemctl stop hostapd && sleep 2
/usr/bin/sudo /bin/systemctl disable hostapd           
/usr/bin/sudo /bin/systemctl enable wpa_supplicant
/usr/bin/sudo /bin/systemctl start wpa_supplicant 
echo "OK"
#/usr/bin/sudo /sbin/reboot
